<!-- ‡πÑ‡∏ü‡∏•‡πå: resources/js/pages/risk_control/AttachmentViewer.vue -->
<!-- 
  ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢: ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
  ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏´‡∏•‡∏±‡∏Å:
  - ‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ï‡πà‡∏≤‡∏á‡πÜ (PDF, ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û, ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£)
  - ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢ (Zoom In/Out)
  - ‡∏´‡∏°‡∏∏‡∏ô‡πÑ‡∏ü‡∏•‡πå (Rotate)
  - ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
  - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö Responsive
  - ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó PDF, Images, Documents
-->

<script setup lang="ts">
// ==================== ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Dependencies ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô ====================
import { ref, computed, onMounted } from 'vue';
import { Head } from '@inertiajs/vue3';
import { toast } from 'vue-sonner';

// ==================== ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Types ====================
import type { RiskControlAttachment } from '@/types/risk-control';

// ==================== ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Components ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ ====================
import FileViewerHeader from '@/components/FileViewer/FileViewerHeader.vue';
import FileViewerControls from '@/components/FileViewer/FileViewerControls.vue';
import FileViewerContent from '@/components/FileViewer/FileViewerContent.vue';

// ==================== ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Props ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö ====================
const props = defineProps<{
  attachment: {
    id: number;
    filename: string;
    filepath: string;
    filetype?: string;
    filesize?: number;
    url: string;
    risk_control_id: number;
    created_at: string;
    updated_at: string;
    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ç‡∏≠‡∏á Risk Control
    risk_control?: {
      id: number;
      control_name: string;
      control_type?: string;
      status: string;
    };
  }
}>();

// ==================== ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° ====================
const fileUrl = ref<string>(props.attachment.url);
const zoom = ref<number>(1);
const rotation = ref<number>(0);
const isLoading = ref<boolean>(true);
const hasError = ref<boolean>(false);
const errorMessage = ref<string>('');

// ==================== Computed Properties ====================
// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
const formattedFileSize = computed(() => {
  const size = props.attachment.filesize || 0;
  if (size === 0) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏Ç‡∏ô‡∏≤‡∏î';
  
  if (size < 1024) {
    return `${size} B`;
  } else if (size < 1024 * 1024) {
    return `${(size / 1024).toFixed(1)} KB`;
  } else {
    return `${(size / (1024 * 1024)).toFixed(1)} MB`;
  }
});

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå
const fileExtension = computed(() => {
  const filename = props.attachment.filename || '';
  return filename.split('.').pop()?.toLowerCase() || '';
});

// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÑ‡∏ü‡∏•‡πå
const fileIcon = computed(() => {
  const ext = fileExtension.value;
  
  if (['pdf'].includes(ext)) return 'file-text';
  if (['jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext)) return 'image';
  if (['doc', 'docx'].includes(ext)) return 'file-text';
  if (['xls', 'xlsx'].includes(ext)) return 'file-spreadsheet';
  
  return 'file';
});

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
const isViewableFile = computed(() => {
  const ext = fileExtension.value;
  return ['pdf', 'jpg', 'jpeg', 'png', 'gif', 'webp'].includes(ext);
});

// ==================== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• ====================
/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤ (Zoom In)
 * ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡πà‡∏≤ zoom ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡πÄ‡∏ó‡πà‡∏≤
 */
const zoomIn = () => {
  const newZoom = Math.min(zoom.value + 0.25, 3);
  zoom.value = newZoom;
  
  console.log('üîç ‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤:', {
    old_zoom: zoom.value - 0.25,
    new_zoom: newZoom,
    filename: props.attachment.filename,
    timestamp: new Date().toISOString()
  });
  
  toast.success(`‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô ${Math.round(newZoom * 100)}%`);
};

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å (Zoom Out)  
 * ‡∏•‡∏î‡∏Ñ‡πà‡∏≤ zoom ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 0.5 ‡πÄ‡∏ó‡πà‡∏≤
 */
const zoomOut = () => {
  const newZoom = Math.max(zoom.value - 0.25, 0.5);
  zoom.value = newZoom;
  
  console.log('üîç ‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å:', {
    old_zoom: zoom.value + 0.25,
    new_zoom: newZoom,
    filename: props.attachment.filename,
    timestamp: new Date().toISOString()
  });
  
  toast.success(`‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô ${Math.round(newZoom * 100)}%`);
};

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢
 * ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (100%)
 */
const resetZoom = () => {
  zoom.value = 1;
  
  console.log('üîç ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢:', {
    filename: props.attachment.filename,
    timestamp: new Date().toISOString()
  });
  
  toast.success('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô 100%');
};

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏°‡∏∏‡∏ô‡πÑ‡∏ü‡∏•‡πå
 * ‡∏´‡∏°‡∏∏‡∏ô‡πÑ‡∏ü‡∏•‡πå 90 ‡∏≠‡∏á‡∏®‡∏≤‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏£‡∏±‡πâ‡∏á
 */
const rotateFile = () => {
  const newRotation = (rotation.value + 90) % 360;
  rotation.value = newRotation;
  
  console.log('üîÑ ‡∏´‡∏°‡∏∏‡∏ô‡πÑ‡∏ü‡∏•‡πå:', {
    old_rotation: rotation.value - 90,
    new_rotation: newRotation,
    filename: props.attachment.filename,
    timestamp: new Date().toISOString()
  });
  
  toast.success(`‡∏´‡∏°‡∏∏‡∏ô‡πÑ‡∏ü‡∏•‡πå ${newRotation} ‡∏≠‡∏á‡∏®‡∏≤`);
};

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô
 * ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏ó‡∏µ‡πà 0 ‡∏≠‡∏á‡∏®‡∏≤
 */
const resetRotation = () => {
  rotation.value = 0;
  
  console.log('üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô:', {
    filename: props.attachment.filename,
    timestamp: new Date().toISOString()
  });
  
  toast.success('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏ô‡πÑ‡∏ü‡∏•‡πå');
};

// ==================== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏ü‡∏•‡πå ====================
/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
 */
const downloadFile = () => {
  try {
    // ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
    const downloadUrl = `/risk-controls/${props.attachment.risk_control_id}/attachments/${props.attachment.id}/download`;
    
    // ‡πÄ‡∏õ‡∏¥‡∏î URL ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
    globalThis.window.open(downloadUrl, '_blank');
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    toast.success('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå...', {
      description: `‡πÑ‡∏ü‡∏•‡πå: ${props.attachment.filename} (${formattedFileSize.value})`
    });
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å log ‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
    console.log('üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå:', {
      attachment_id: props.attachment.id,
      filename: props.attachment.filename,
      filesize: props.attachment.filesize,
      risk_control_id: props.attachment.risk_control_id,
      control_name: props.attachment.risk_control?.control_name,
      download_url: downloadUrl,
      timestamp: new Date().toISOString()
    });
    
  } catch (error) {
    // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
    console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå:', error);
    
    toast.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå', {
      description: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö'
    });
  }
};

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÑ‡∏ü‡∏•‡πå
 * ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏õ‡∏¢‡∏±‡∏á clipboard
 */
const copyFileUrl = async () => {
  try {
    await navigator.clipboard.writeText(props.attachment.url);
    
    toast.success('‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
    
    console.log('üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL ‡πÑ‡∏ü‡∏•‡πå:', {
      attachment_id: props.attachment.id,
      filename: props.attachment.filename,
      url: props.attachment.url,
      timestamp: new Date().toISOString()
    });
    
  } catch (error) {
    console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL:', error);
    toast.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å URL');
  }
};

// ==================== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏≥‡∏ó‡∏≤‡∏á ====================
/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤
 * ‡πÉ‡∏ä‡πâ history.back() ‡∏´‡∏£‡∏∑‡∏≠‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
 */
const goBack = () => {
  try {
    // ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ history.back() ‡∏Å‡πà‡∏≠‡∏ô
    if (globalThis.window.history.length > 1) {
      globalThis.window.history.back();
    } else {
      // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ history ‡πÉ‡∏´‡πâ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
      globalThis.window.location.href = '/risk-controls';
    }
    
    console.log('üîô ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤:', {
      attachment_id: props.attachment.id,
      filename: props.attachment.filename,
      risk_control_id: props.attachment.risk_control_id,
      timestamp: new Date().toISOString()
    });
    
  } catch (error) {
    console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤:', error);
    
    // fallback: ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
    globalThis.window.location.href = '/risk-controls';
  }
};

/**
 * ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á
 */
const goToRiskControl = () => {
  const url = `/risk-controls/${props.attachment.risk_control_id}`;
  globalThis.window.location.href = url;
  
  console.log('üìÑ ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á:', {
    risk_control_id: props.attachment.risk_control_id,
    control_name: props.attachment.risk_control?.control_name,
    url: url,
    timestamp: new Date().toISOString()
  });
};

// ==================== Event Handlers ====================
/**
 * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏™‡∏£‡πá‡∏à
 */
const handleFileLoaded = () => {
  isLoading.value = false;
  hasError.value = false;
  errorMessage.value = '';
  
  console.log('‚úÖ ‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢:', {
    attachment_id: props.attachment.id,
    filename: props.attachment.filename,
    filetype: props.attachment.filetype,
    timestamp: new Date().toISOString()
  });
  
  toast.success('‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
};

/**
 * ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå
 */
const handleFileError = (error: Error | string) => {
  isLoading.value = false;
  hasError.value = true;
  errorMessage.value = typeof error === 'string' ? error : error.message;
  
  console.error('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå:', {
    attachment_id: props.attachment.id,
    filename: props.attachment.filename,
    error: errorMessage.value,
    timestamp: new Date().toISOString()
  });
  
  toast.error('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå', {
    description: errorMessage.value
  });
};

// ==================== Lifecycle Hooks ====================
onMounted(() => {
  // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å log ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå
  console.log('üìÇ ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á:', {
    attachment_id: props.attachment.id,
    filename: props.attachment.filename,
    filetype: props.attachment.filetype,
    filesize: props.attachment.filesize,
    risk_control_id: props.attachment.risk_control_id,
    control_name: props.attachment.risk_control?.control_name,
    control_type: props.attachment.risk_control?.control_type,
    is_viewable: isViewableFile.value,
    timestamp: new Date().toISOString()
  });
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  if (!isViewableFile.value) {
    toast.info('‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤', {
      duration: 5000
    });
  }
});
</script>

<template>
  <!-- ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö -->
  <Head :title="`‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏ô‡∏ö: ${attachment.filename}`" />
  
  <!-- ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÑ‡∏ü‡∏•‡πå -->
  <div class="h-screen flex flex-col bg-gray-100">
    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå -->
    <FileViewerHeader 
      :fileName="attachment.filename"
      :fileSize="attachment.filesize || 0"
      :fileType="attachment.filetype"
      :controlInfo="{
        name: attachment.risk_control?.control_name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
        type: attachment.risk_control?.control_type,
        status: attachment.risk_control?.status
      }"
      @go-back="goBack"
      @go-to-control="goToRiskControl"
    >
      <!-- ‡πÉ‡∏ä‡πâ slot ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏ó‡∏£‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏ü‡∏•‡πå -->
      <FileViewerControls 
        :zoom="zoom"
        :rotation="rotation"
        :canZoom="isViewableFile"
        :canRotate="isViewableFile"
        :isLoading="isLoading"
        @zoom-in="zoomIn"
        @zoom-out="zoomOut"
        @reset-zoom="resetZoom"
        @rotate="rotateFile"
        @reset-rotation="resetRotation"
        @download="downloadFile"
        @copy-url="copyFileUrl"
      />
    </FileViewerHeader>
    
    <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå -->
    <FileViewerContent 
      :fileUrl="fileUrl"
      :fileName="attachment.filename"
      :fileType="attachment.filetype || fileExtension"
      :fileIcon="fileIcon"
      :zoom="zoom"
      :rotation="rotation"
      :isLoading="isLoading"
      :hasError="hasError"
      :errorMessage="errorMessage"
      :isViewable="isViewableFile"
      :formattedSize="formattedFileSize"
      @download="downloadFile"
      @loaded="handleFileLoaded"
      @error="handleFileError"
    />
  </div>
</template>

<style scoped>
/* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏î‡∏π‡πÑ‡∏ü‡∏•‡πå (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô) */
.file-viewer-container {
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

/* Animation ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î */
.loading-animation {
  animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.5;
  }
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .h-screen {
    height: 100vh;
    height: 100dvh; /* ‡πÉ‡∏ä‡πâ dynamic viewport height ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö mobile */
  }
}
</style>
